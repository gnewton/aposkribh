
/aposkribh.test# where not{

    /aposkribh.test# 20 dict def


    aposkribh.test# begin

    /aposkribh.StopOnFail where not{
        /aposkribh.StopOnFail true def
    }if

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    /runTest{
        2 dict begin
        
        /_testName exch def
        {
            mark (Pass: ) _testName strcatmark =
        }
        {
            mark (Fail: ) _testName strcatmark =
            aposkribh.StopOnFail{
                quit
            }if
        }ifelse
        end
    }bind def


    /assertStack{% args {proc} [ expected stack values] (msg)

    }bind def

        %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    /assertError{% expectedError {stuff-to-exec} (msg) -> bool
        2 dict begin
        /expectedError exch def
        {
            exec
        }stopped{
            /actualError $error /errorname get def

            expectedError actualError eq{
                mark (OK) (% AssertError) verbose2
                true
            }{
                mark (actualError does not match expected error) =
                actualError =
                expectedError =
                false
                aposkribh.StopOnFail{
                    quit
                }if
            }ifelse
        }{
            mark (assertError: should be an error) verbose2
            false
        }ifelse
        end
    }bind def


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    /assertNotError{
        {
            exec
        }stopped{
            mark (assertNotError: should NOT be an error) verbose2
            false
        }{
            mark (OK) (% AssertNotError) verbose2
            true
        }ifelse
    }bind def



    
    /runTests.Errors{ % array of {{proc test} msg}
        5 dict begin
        /_a exch def
        _a{
            exec
            /expectedError exch def
            /msg exch def
            /tproc exch def
            {
                clear
                tproc
            } expectedError assertError msg  runTest
        }forall
    end
    }bind def

    /runTests.NoErrors{ % array of '{{proc test} msg}'
        5 dict begin
        /_a exch def
        _a{
            exec
            /msg exch def
            /tproc exch def
            {
                clear
                tproc
            }assertNotError msg runTest
        }forall
        end
    }def

    /runTests.StackReturn{ % array of '{{proc test} [expected stack] msg}'
        5 dict begin
        /_a exch def
        _a{
            exec
            /msg exch def
            /expectedStack exch def
            /tproc exch def
            {
                clear
                tproc
            }assertNotError msg runTest
        }forall
        end
    }def

    end  % aposkribh_test# 
}if
